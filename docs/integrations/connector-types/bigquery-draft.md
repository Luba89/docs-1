---
title: BigQuery - DRAFT
---

Macrometa collection connectors allow you to extract data from or send data to an existing BigQuery collection.

## Prerequisites

- Macrometa account with admin permissions.
- Remotely accessible, running BigQuery instance.
- Source collections must not be empty.

## BigQuery Source

UI:
Required
- Integration Name
- Project ID
- Credentials JSON file
Advanced
- Add Extracted Timestamp
- Limit

Repo:

| Config keys             | Type    | Required? | Description     | Default | Example       |
|-------------------------|---------|-----------|-----------------|---------|---------------|
| project   | String  | Yes       | Your BigQuery project ID.     | None    | my_project_id |
| table     | String  | Yes       | Fully qualified table name in BigQuery, with format `<project>.<dataset>.<table>`.    | None    | `<project><dataset><table>` |
| credentials_file        | String  | Yes       | Content of the credentials.json file for your service account. See the "Activate the Google BigQuery API" section of the repository's README and https://cloud.google.com/docs/authentication/production.           | None    | credentials.json contents   |
| columns   | String  | No        | Comma-separated list of columns to be selected. Use "*" to select all columns         | *       | *             |
| primary_key             | String  | No        | A unique primary key from the bigquery table which needs be used as _key for the collection. If the columns does not have any column with unique values then do not specify anything here, _key for the collection will be autogenerated in this case. Primary key is case sensitive.     | None    | my_primary_key|
| filters   | String  | No        | Comma-separated list of WHERE clauses to filter extracted data, e.g. "column = "value".             | None    | my_filters    |
| add_extracted_timestamp | Boolean | No        | If true adds metadata `_sdc_extracted_at`. The timestamp of the record when it was extracted from the source.     | FALSE   | False         |
| limit     | Int     | No        | Limits the number of records returned, applied as a limit in the query. | None    | 1000          |

## BigQuery Target

UI:
Required
- Integration Name
- Project ID
- Credentials JSON file
Advanced
- Location
- Target Schema privileges
- Batch Size
- Batch Wait Limit
- Add Metadata Columns
- Hard Delete
- Data Flattening Max Level
- Primary Key Required
- Validate Records
- Temporary Schema
- Use Partition Pruning

Repo:

| Config keys | Type    | Required? | Description     | Default | Example     |
|-------------|---------|-----------|-----------------|---------|-------------|
| Connection Name       | String  | Yes        | Name of the connection            | None   | FromBigQuery    |
| Project ID    | String  | Yes        | Bigquery project ID.   | None   | my_project_id           |
| Credentials JSON file    | String | Yes        | Content of the credentials.json file for your service account. See the "Activate the Google BigQuery API" section of the repository\'s README and https://cloud.google.com/docs/authentication/production.    | None   | my_credentials     |
| Target Schema/Dataset   | String  | Yes        | Name of the schema/dataset where the tables will be created.    | None   | my_schema  |
| Target Table             | String  | Yes        | Name of the bigquery table. The table will be created if it does not exist.| None   | my_table  |
| Location            | String  | No        | Region where BigQuery stores your dataset.            | None   | my_location  |
| Target Schema privileges            | String  | No        | Grant USAGE privilege on newly created schemas and grant SELECT privilege on newly created table.            | None   | SELECT  |
| Batch Size            | Integer | No         | Maximum number of rows in each batch. At the end of each batch, the rows in the batch are loaded into BigQuery.      | 10000     | 1000       |
| Batch wait limit (Seconds)            | Integer | No         | Maximum time to wait for batch to reach batch_size_rows.     | None     | 60       |
| Add Metadata Columns           | Boolean | No         | Metadata columns add extra row level information about data ingestions, (i.e. when was the row read in source, when was inserted or deleted in bigquery, etc.) Metadata columns are created automatically by adding extra columns to the tables with a column prefix _sdc_. The column names are following the stitch naming conventions documented at https://www.stitchdata.com/docs/data-structure/integration-schemas#sdc-columns.     | False     | True       |
| Hard Delete          | Boolean | No         | When hard_delete option is true then DELETE SQL commands will be performed in BigQuery to delete rows in tables. It\'s achieved by continuously checking the _sdc_deleted_at metadata column sent by the data source. Due to deleting rows requires metadata columns, hard_delete option automatically enables the add_metadata_columns option as well.     | False     | True       |
| Data Flattening Max Level           | Integer  | No        | Object type RECORD items from data source can be loaded into VARIANT columns as JSON (default) or we can flatten the schema by creating columns automatically. When value is 0 (default) then flattening functionality is turned off.       | 0   | 1  |
| Primary Key Required         | Boolean | No         | Tables with no Primary Key cause duplicates when merging UPDATE events. When set to true, stop loading data if no Primary Key is defined.    | True     | False       |
| Validate Records       | Boolean | No         | Validate every single record message to the corresponding JSON schema. This option is disabled by default and invalid RECORD messages will fail only at load time by BigQuery. Enabling this option will detect invalid records earlier but could cause performance degradation.   | False     | True       |
| Temporary Schema           | String  | No        | Name of the schema where the temporary tables will be created. Will default to the same schema as the target tables.            | None   | my_temp_schema  |
| Use Partition Pruning       | Boolean | No         | If true then BigQuery table partition pruning will be used for tables which have partitioning enabled. This partitioning should be on a column which is immutable such as an integer primary key or a created_at column. The partitioning should be set up manually by the user. This feature can dramatically reduce the cost of each MERGE for large tables.  | False     | True       |
