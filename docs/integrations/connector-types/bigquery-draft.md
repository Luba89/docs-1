---
title: BigQuery - DRAFT
---

Macrometa collection connectors allow you to extract data from or send data to an existing BigQuery collection.

## Prerequisites

- Macrometa account with admin permissions.
- Remotely accessible, running BigQuery instance.
- Source collections must not be empty.

## BigQuery Source

UI:
Required
- Integration Name
- Project ID
- Credentials JSON file
Advanced
- Add Extracted Timestamp
- Limit

Repo:

| Config keys             | Type    | Required? | Description     | Default | Example       |
|-------------------------|---------|-----------|-----------------|---------|---------------|
| project   | String  | Yes       | Your BigQuery project ID.     | None    | my_project_id |
| table     | String  | Yes       | Fully qualified table name in BigQuery, with format `<project>.<dataset>.<table>`.    | None    | `<project><dataset><table>` |
| credentials_file        | String  | Yes       | Content of the credentials.json file for your service account. See the "Activate the Google BigQuery API" section of the repository's README and https://cloud.google.com/docs/authentication/production.           | None    | credentials.json contents   |
| columns   | String  | No        | Comma-separated list of columns to be selected. Use "*" to select all columns         | *       | *             |
| primary_key             | String  | No        | A unique primary key from the bigquery table which needs be used as _key for the collection. If the columns does not have any column with unique values then do not specify anything here, _key for the collection will be autogenerated in this case. Primary key is case sensitive.     | None    | my_primary_key|
| datetime_key            | String  | No        | Name of datetime column to use as replication key.        | None    | my_datetime_key             |
| filters   | String  | No        | Comma-separated list of WHERE clauses to filter extracted data, e.g. "column = "value".             | None    | my_filters    |
| start_datetime          | String  | No        | Determines how much historical data will be extracted. Please be aware that the larger the time period and amount of data, the longer the initial extraction can be expected to take.   | None    | 2017-01-01T00:00:00Z        |
| end_datetime            | String  | No        | Date up to when historical data will be extracted.        | None    | 2017-01-01T00:00:00Z        |
| add_extracted_timestamp | Boolean | No        | If true adds metadata `_sdc_extracted_at`. The timestamp of the record when it was extracted from the source.     | FALSE   | False         |
| limit     | Int     | No        | Limits the number of records returned, applied as a limit in the query. | None    | 1000          |
| start_always_inclusive  | Boolean | No        | When replicating incrementally, disable to only select records whose datetime_key is greater than the maximum value replicated in the last run, by excluding records whose timestamps match exactly. This could cause records to be missed that were created after the last run finished, but during the same second and with the same timestamp. | TRUE    | True          |

## BigQuery Target

UI:
- Integration Name
- Lots of mismatches similar to above, mostly the underscores instead of spaces

Repo:

| Config keys | Type    | Required? | Description     | Default | Example     |
|-------------|---------|-----------|-----------------|---------|-------------|
| project_id  | String  | Yes       | BigQuery project ID | None    | Project ID  |
| credentials_file          | String  | Yes       | Fully qualified path to client_secrets.json for your service account. See the "Activate the Google BigQuery API" section of the repository's README and https://cloud.google.com/docs/authentication/production.        | None    | credentials.json contents |
| target_schema   | String  | Yes  | Name of the schema/dataset where the tables will be created. | None    | None |
| target_table| String  | Yes       | Name of the bigquery table. The table will be created if it does not exist. | None    | None        |
| location    | String  | No        | Region where BigQuery stores your dataset.      | None    | None        |
| default_target_schema_select_permission | String  | No        | Grant USAGE privilege on newly created schemas and grant SELECT privilege on the newly created table    | None    | SELECT      |
| batch_size_rows           | Int     | No        | Maximum number of rows in each batch. At the end of each batch, the rows in the batch are loaded into BigQuery.       | 10000   | 100         |
| batch_size_limit_seconds  | Int | No  | Maximum time to wait for batch to reach batch_size_rows.     | None | 60 |
| flush_all_streams         | Boolean | No        | Flush and load every stream into BigQuery when one batch is full. Warning: This may trigger transfer of data with low number of records, and may cause performance problems.  | FALSE   | False       |
| parallelism | Int     | No        | The number of threads used to flush tables. 0 will create a thread for each stream, up to parallelism_max. -1 will create a thread for each CPU core. Any other positive number will create that number of threads, up to parallelism_max.          | 0       | 0           |
| max_parallelism           | Int     | No        | Max number of parallel threads to use when flushing tables.   | 16      | 16          |
| add_metadata_columns      | Boolean | No        | Metadata columns add extra row level information about data ingestions, (i.e. when was the row read in source, when was inserted or deleted in bigquery etc.) Metadata columns are creating automatically by adding extra columns to the tables with a column prefix _sdc_. The column names are following the stitch naming conventions documented at https://www.stitchdata.com/docs/data-structure/integration-schemas#sdc-columns. Enabling metadata columns will flag the deleted rows by setting the _sdc_deleted_at metadata column. Without the add_metadata_columns option the deleted rows from singer taps will not be recognizable in BigQuery. | FALSE   | False       |
| hard_delete | Boolean | No        | When hard_delete option is true then DELETE SQL commands will be performed in BigQuery to delete rows in tables. It's achieved by continuously checking the sdc_deleted_at metadata column sent by the singer tap. Due to deleting rows requires metadata columns, hard_delete option automatically enables the add_metadata_columns option as well.  | FALSE   | False       |
| data_flattening_max_level | Int     | No        | Object type RECORD items from data source can be loaded into VARIANT columns as JSON (default) or we can flatten the schema by creating columns automatically. When value is 0 (default) then flattening functionality is turned off. | 0       | 0           |
| primary_key_required      | Boolean | No        | Log based and Incremental replications on tables with no Primary Key cause duplicates when merging UPDATE events. When set to true, stop loading data if no Primary Key is defined.         | TRUE    | True        |
| validate_records          | Boolean | No        | Validate every single record message to the corresponding JSON schema. This option is disabled by default and invalid RECORD messages will fail only at load time by BigQuery. Enabling this option will detect invalid records earlier but could cause performance degradation.| FALSE   | False       |
| temp_schema | String  | No        | Name of the schema where the temporary tables will be created. Will default to 'the same schema as the target tables  | None    | my_temp_schema            |
| use_partition_pruning     | Boolean | No        | If true then BigQuery table partition pruning will be used for tables which have partitioning enabled. This partitioning should be on a column which is immutable such as an integer primary key or a created_at column. The partitioning should be set up manually by the user. This feature can dramatically reduce the cost of each MERGE for large tables.      | FALSE   | False       |
